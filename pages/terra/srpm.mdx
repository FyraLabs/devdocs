---
title: SRPM Macros
description: "Documentation on the macros included in the anda-srpm-macros package."
---

import { Callout } from "nextra/components";

# SRPM Macros

We provide custom SRPM macros to ease packaging and better integrate our workflow. Please use these macros when possible in Terra.

These are provided in the `anda-srpm-macros` package. If you use them, make sure to add `anda-srpm-macros` as a `BuildRequires:{:rpmspec}` in the spec file.

You may need to refer to the [Terra packaging guidelines](./guidelines) for non-macro related Terra guidelines.
If looking for documentation on our metainfo macros, check that out [here](./appstream).

If you would like to contribute to these macros, check out the [SRPM macros repository](https://github.com/terrapkg/srpm-macros).

For upstream macros available in Fedora/Terra, check out our unofficial [macros list](../rpm/macros).

<Callout type="info">
  The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
  NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
  "OPTIONAL" in this document are to be interpreted as described in
  [RFC 2119](https://www.rfc-editor.org/rfc/rfc2119) and
  [RFC 8174](https://www.rfc-editor.org/rfc/rfc8174).
</Callout>

## Directories
These macros define certain system directories, and SHOULD be used in place of the raw directory path.

### %_appsdir
Expands to: `%_datadir/applications{:rpmspec}` or `/usr/share/applications{:rpmspec}`

This may seem like a directory to place the application itself into, but this directory is used for application's `.desktop` files.

### %_bun_cache_dir
The directory where Bun cache files are stored in.

Expands to: `%{_bun_home}/install/cache{:rpmspec}`

Used for [Bun macros](#bun-macros).

### %_bun_home
The directory where Bun files are stored in.
Unfortunately, Bun doesn't actually have a way to enforce this yet.
However the proposed environment variable is `$BUN_HOME`, so we have this for the future.

Expands to: `%{rpmbuilddir}/.bun{:rpmspec}`

Used for [Bun macros](#bun-macros).

### %elvish_completions_dir
Expands to: `%_datadir/elvish/lib/completions{:rpmspec}`

Used in [`%pkg_completions`](#pkg_completion), or manually when `%pkg_completions` cannot be used.

### %_hicolordir
Expands to: `%_iconsdir/hicolor{:rpmspec}` or `/usr/share/icons/hicolor{:rpmspec}`

The directory that SHOULD be used when installing application `.png` files. Note that you then MUST install the (typically app icon) file to the `apps` folder within the fixed-size directory in `%_hicolordir{:rpmspec}`.

For example:

```bash
# Lets say package 'foo' has a 16x16 and 64x64 .png
install -Dm644 icons/16x16.png %{buildroot}%{_hicolordir}/16x16/apps/%{name}.png
install -Dm644 icons/64x64.png %{buildroot}%{_hicolordir}/64x64/apps/%{name}.png
```

If the file is an `.svg`, use the [`%_scalableiconsdir`](#_scalableiconsdir).

### %_npm_cache_dir
Expands to: `%{rpmbuilddir}/.npm{:rpmspec}`

Used with [JavaScript package manager macros](#javascript-runtimes), especially [NPM macros](#npm-macros).

### %nushell_completions_dir
Expands to: `%_datadir/nushell/vendor/autoload{:rpmspec}`

Used in [`%pkg_completions`](#pkg_completion), or manually when `%pkg_completions` cannot be used.

### %_nvm_dir
The location in the `%{rpmbuilddir}{:rpmspec}` what will be passed to `$NVM_DIR{:rpmspec}`, which is where vendored Node.js installs and cache are stored.

Expands to: `%{rpmbuilddir}/.nvm{:rpmspec}`

Only used for for [`%{__nvm}`](#__nvm).

### %_pkgconfigdir
Expands to: `%{_libdir}/pkgconfig{:rpmspec}`

Used in the `%files{:rpmspec}` section.

### %_pnpm_home
The directory where PNPM files and cache are stored.

Expands to: `%{rpmbuilddir}/.pnpm{:rpmspec}`

Used for [PNPM macros](#pnpm-macros).

### %_pnpm_store
The directory where Node modules installed by PNPM usually go. This will usually not be produced when using PNPM as a build tool, but exists for rare builds it may be created in.

Expands to: `%{_pnpm_home}/store{:rpmspec}`

Used for [PNPM macros](#pnpm-macros).

### %rpmbuilddir
This macro exists because Terra supports EL distributions (Red Hat Enterprise Linux, Alma Linux, etc.) which currently have an RPM version from before the `%{builddir}{:rpmspec}` change to address issues [like this](https://github.com/rpm-software-management/rpm/issues/3151).

One, albeit clunky, solution is to define `%{builddir}{:rpmspec}` manually as `%{_builddir}{:rpmspec}` in specs targeting distros with different versions of RPM where one has a version older than 4.20. We have this macro instead to make the process easier without overriding any builtin RPM macros. For more information on this solution, see [these](https://github.com/rpm-software-management/rpm/issues/3151#issuecomment-2154550735) [comments](https://github.com/rpm-software-management/rpm/issues/3151#issuecomment-2154639192) on the issue linked above.

This macro is subject to deprecation once all EL distributions with an RPM version older than 4.20 are end-of-life (likely when EL10 is end-of-life), or in the event we can no longer support EL distributions this old.

Expands to: `%{?builddir}%{?!builddir:%{_builddir}}{:rpmspec}`

### %_scalableiconsdir
Expands to: `%_hicolordir/scalable/apps{:rpmspec}` or `/usr/share/icons/hicolor/scalable/apps{:rpmspec}`
The directory that SHOULD be used when installing application `.svg` files to.
You do not need to specify any folders for this macro, the file can be added to the end of this macro.
For example:

```bash
install -Dm644 icons/%{name}.svg %{buildroot}%{_scalableiconsdir}/%{name}.svg
```

If the file is a `.png`, use [`%_hicolordir{:rpmspec}`](#_hicolordir).

### %_yarn_cache_dir
The directory where Yarn cache files are stored in.

Expands to: `%{rpmbuilddir}/.yarn{:rpmspec}`

Used for [Yarn macros](#yarn-macros).

## Go
These macros assist with building Go projects.

### %goprep_online
MAY be used to prep a Go package for online builds. Replaces `%goprep{:rpmspec}` in `%prep{:rpmspec}`.

## JavaScript Runtimes
These are macros to assist with the general packaging of applications that use JavaScript runtimes, such as Node.js or Bun.

### Node.js Macros
Macros for using [Node.js](https://nodejs.org). These require the use of [Fedora Node.js macros](https://docs.fedoraproject.org/en-US/packaging-guidelines/Node.js/#_macros) in the `nodejs-packaging` package.

You MUST either set `%global npm_name pkgname{:rpmspec}` or use `%npm_prep -n pkgname{:rpmspec}` when packaging Node modules directly. This MUST be defined as the canonical name of the module as listed on the [NPM Registry](https://www.npmjs.com/).

#### %__nvm
Calls NVM (Node Version Manager) while setting `$NVM_DIR{:bash}`. Only used if vendoring Node.js.

Expands to: `/usr/bin/env NVM_DIR=%{_nvm_dir} /usr/bin/nvm{:rpmspec}`

#### %vendor_nodejs
This macro SHOULD only be used if Node.js packages available from the repos are not usable for some reason.

You MUST add `nvm` as a build dependency: `BuildRequires: nvm{:rpmspec}`.

Available flags:
- `-v{:rpmspec}` is REQUIRED for this macro to pass the version to NVM. This flag accepts a full version, the major for the latest of a major version of Node.js (e.g., `24`), or `node` to use the latest version of Node.js available.

Usecase examples:
- Fedora has not yet packaged the correct version of Node.js or the required version is older than what is supplied.
  - This means that packaged Node modules will probably not meet their runtime requirements, but Electron apps may be fine.
- EL does not yet have the correct version of Node.js.
  - This poses the same concern as above.

For this reason, whatever you are packaging SHOULD be tested locally upon a successful build to see if it has any runtime issues.

What `%vendor_nodejs{:rpmspec}` does:
1. Installs the desired Node.js version to `%{_nvm_dir}{:rpmspec}`.
1. Redefines `%{__nodejs}{:rpmspec}` to run the vendored version through NVM.
1. Sets a `%bcond{:rpmspec}` to `vendored_nodejs{:rpmspec}` so other macros will use the vendored version.

Vendored versions of NPM and NPX are subject to limitations in commands as they must be run through `exec`.

### Node Module Macros
"Node modules" refer to JavaScript packages run using a JavaScript runtime (usually Node.js), almost always hosted on the [NPM Registry](https://www.npmjs.com/).

#### %npm_prep
Prepare a Node module for build steps.

Available flags:
- `-n{:rpmspec}` MUST be used to define `%{npm_name}{:rpmspec}` if it was not defined as a global macro.

#### %fetch_node_tests
Fetch self-tests from a Git repo. MUST include all necessary test files and folders. If used, it SHOULD be placed in the `%prep{:rpmspec}` section.

Available flags:
- `-u{:rpmspec}` MUST be used to define the URL if the one listed in the `URL:{:rpmspec}` tag for the package is not detectable as clonable.

All necessary test files and folders MUST be listed after the macro. Test folders MUST start with `/{:rpmspec}`.

Example usage:
```rpmspec
%prep
%npm_prep
%fetch_node_tests -u https://github.com/dev/module.git /tests .eslintrc
```

#### %npm_install
Install a Node module to `%{npm_sitelib}{:rpmspec}` and symlink its executable.

NOTE: This macro sets the environment variable `$_js`. This environment variable has a very simple purpose: It is defined as `.js` if a Node module's executable ends in a `.js` extension.

How this is used: If for any reason you need to execute a Node module itself as part of the build, you SHOULD do `/path/to/%{npm_name}$_js{:rpmspec}` after using `%npm_install{:rpmspec}`. `$_js` will expand to nothing if not defined and will expand to the `.js` extension if defined.

Real package example:
```rpmspec
%install
%npm_install -s license-checker

# Bootstrap the license fetching
# Environment variable is one set during execution of %%npm_install
./bin/%{npm_name}$_js --limitAttributes licenses --out LICENSE.modules
```

#### %npm_test
Runs generic NPM tests. This will not be applicable to all Node modules. For use in the `%check{:rpmspec}` section.

Expands to: `%{__npm} test{:rpmspec}`

#### %node_self_test
Runs self-defined tests on the Node module. This is not applicable for all Node modules. Also, not all tests (that are supported as Node modules) can use a wide variety of testing tools. For use in `%check{:rpmspec}`.

Available flags:
- `-R{:rpmspec}`: Direct duplicate of an `-R{:rpmspec}` flag. Project dependent.
- `-v{:rpmspec}`: Direct duplicate of a `-v{:rpmspec}` flag. Project dependent.

You MUST use [`%fetch_node_tests`](#fetch_node_tests) first if using this.

#### %__npm_license_checker
Expands to: `/usr/bin/license-checker`

Runs the NPM `license-checker` command, documented [here](https://www.npmjs.com/package/license-checker-rseidelsohn).

Example output:

```
/usr/bin/license-checker
└─ @fyralabs/devdocs@@0.0.1
   ├─ licenses: MIT
   ├─ repository: https://github.com/FyraLabs/devdocs
   ├─ publisher: Lleyton Gray
   ├─ email: lleyton@fyralabs.com
   ├─ path: /home/owen/Documents/Projects/devdocs
   └─ licenseFile: /home/owen/Documents/Projects/devdocs/LICENSE
```

#### %npm_license
Expands to: `/usr/bin/license-checker --limitAttributes licenses`

This is similar to [`%__npm_license_checker`](#__npm_license_checker), but limits the output to only the license.

Available flags:
- `-o{:rpmspec}` MAY be used as a shorthand for `--out{:rpmspec}`.

Example output:

```
/usr/bin/license-checker --limitAttributes licenses
└─ @fyralabs/devdocs@@0.0.1
   └─ licenses: MIT
```

SHOULD be used if packaging Node modules.

Example usage:

```rpmspec
%{npm_license} --out LICENSE.modules
```

OR:

```rpmspec
%npm_license -o LICENSE.modules
```

The above would create a `LICENSE.modules` file which can then be packaged using `%license LICENSE.modules{:rpmspec}`.

#### %npm_license_summary
Outputs a summary of the bundled licenses. Useful for determining what to put in the `License:{:rpmspec}` section for Node modules.

Expands to: `%{__npm_license_checker} --summary`

### Notes for JavaScript Package Managers:
1. The JavaScript package manager cache directories are placed in [`%{rpmbuilddir}`](#rpmbuilddir) because `$HOME{:bash}` can be different depending on if a build is in Mock or RPM Build.
  - This is very important for consistent macro behavior as well as if the cache must be modified or deleted during build for any reason.
2. All macros calling the package managers also call NPM environment variables because most of them are using build dependencies from the NPM Registry, some even wrap NPM commands with their own. This ensures consistent NPM behavior.

### NPM Macros
Macros for using [NPM](https://www.npmjs.com).

#### %npm_common_envvars
**NOTE:** NPM environment variables written in uppercase will be __ignored__ if the project sets different ones explicitly. This is intentional behavior which these macros do not override in order to avoid build issues. For more information, please see [this issue](https://github.com/npm/npm/issues/14528) in the original NPM GitHub repository.
  - If for any reason you need to hardcode an environment override, use a flag passed to NPM or manually set the environment variable in all lowercase.
  - For more information on NPM config flags and environment variables, please go [here](https://docs.npmjs.com/cli/v11/using-npm/config).

Expands to: `NPM_CONFIG_USERCONFIG=%{rpmbuilddir}/.npmrc NPM_CONFIG_GLOBALCONFIG=%{rpmbuilddir}/npmrc NPM_CONFIG_CACHE=%{_npm_cache_dir} NPM_CONFIG_LOGLEVEL=error NPM_CONFIG_FUND=false NPM_CONFIG_UPDATE_NOTIFIER=false NO_UPDATE_NOTIFIER=1 NPM_CONFIG_COLOR=always NPM_CONFIG_INIT_MODULE=%{rpmbuilddir}/.npm-init.js`

What these do:
- Forces all configuration files into the `%{rpmbuilddir}{:rpmspec}` so they are easily locatable and to prevent attempting to write to the host file system for global config.
- Sets the NPM log level to errors (previously `warn` but this included warnings irrelevant to builds or Node modules).
- Disables funding notifications as this does not make sense to display in an automated build and causes log spam.
- Disables update notifications since we are using a packaged version of NPM unless using `%vendor_nodejs{:rpmspec}`.
- Sets color to `always` for more easily readable logs.

#### %npm_buildflags
Explicit NPM configuration flags of the environment variables set by the Macros.

Expands to: `--userconfig=%{rpmbuilddir}/.npmrc --globalconfig=%{rpmbuilddir}/npmrc --cache=%{rpmbuilddir}/.npm --loglevel=error --fund=false --update-notifier=false --color=always --init-module=%{rpmbuilddir}/.npm-init.js{:rpmspec}`

#### %__npm
Macro to call NPM with predetermined enviroment variables.

Expands to: `/usr/bin/env %{npm_common_envvars} %{?with_vendored_nodejs:%{__nvm} exec npm --}%{!?with_vendored_nodejs:/usr/bin/npm}{:rpmspec}`

#### %__npx
Remotely run Node modules with NPX.

Expands to: `/usr/bin/env %{npm_common_envvars} %{?with_vendored_nodejs:%{__nvm} exec npx --}%{!?with_vendored_nodejs:/usr/bin/npx}{:rpmspec}`

#### %npm_audit
Audit with NPM if package uses bundled Node dependencies. For use in the `%check{:rpmspec}` section.

Vulnerabilities for Node modules __not bundled in the final package__ SHOULD NOT be fixed. If a vulnerability is found *only* in build dependencies, you are fine to leave it as is.

#### %npm_audit_fix
Fix vulnerabilities found using `%npm_audit{:rpmspec}`. Should be used in `%prep{:rpmspec}` section.

Installed packages with fixed dependencies SHOULD be tested first to make sure the applied fix did not cause any issues.

Available flags:
- `-d{:rpmspec}` will run with `--dry-run{:rpmspec}` so you can check what the fix would do.
- `-f{:rpmspec}` will run with `--force{:rpmspec}`, ignoring package locks or other requirements set by the module to fix the dependencies. This MUST be tested locally and verified to not cause breakage.
- `-o{:rpmspec}` will omit a dependency or group (such as `dev{:rpmspec}`) from being fixed.
- `-O{:rpmspec}` will only fix a specified depency or group.
- `-p{:rpmspec}` will limit the run to the package lock.

LIMITATION: Cannot be used on modules installed using the `-g{:rpmspec}` flag (which is done in `%npm_prep{:rpmspec}`) which use a package lock.

### Bun Macros
Macros for using [Bun](https://bun.com).

#### %bun_common_envvars
Sets the `$BUN_HOME{:bash}` for future use and sets the cache dir.

Expands to: `%{npm_common_envvars} BUN_HOME=%{_bun_home} BUN_INSTALL_CACHE_DIR=%{_bun_cache_dir} BUN_RUNTIME_TRANSPILER_CACHE_PATH=%{_bun_cache_dir} FORCE_COLOR=1{:rpmspec}`

#### %__bun
Expands to: `/usr/bin/env %{bun_common_envvars} /usr/bin/bun`

#### %__bunx
Run Node modules (downloading them if necessary) with Bun.

Expands to: `/usr/bin/env %{bun_common_envvars} /usr/bin/bunx`

#### %bun_audit
Audit with Bun if package uses bundled Node dependencies. For use in the `%check{:rpmspec}` section.

<Callout>
  `bun audit` is currently just a wrapper for NPM audit but lacks the `fix` option; use `%npm_audit_fix{:rpmspec}` to fix vulnerabilities.
</Callout>

You SHOULD NOT need to fix vulnerabilities for Node modules that are __not bundled in the final package__. This means if a vulnerability is found *only* in build dependencies, you are fine to leave them be.

#### %bun_pm_trust
Add Node modules to trusted dependencies so their postinstall scripts can be run. SHOULD only be used if necessary.

Available flags:
- `-a{:rpmspec}` can be used to trust all dependencies, otherwise simply list the dependencies you want to trust after the command.

Expands to: `%{__bun} pm trust{:rpmspec}`

### PNPM Macros
Macros for using [PNPM](https://pnpm.io).

#### %pnpm_common_envvars
Sets the NPM environment variables and the PNPM home directory.

Expands to: `%{npm_common_envvars} PNPM_HOME=%{_pnpm_home}{:rpmspec}`

#### %__pnpm

Expands to: `/usr/bin/env %{pnpm_common_envvars} %{?with_vendored_pnpm:%{_pnpm_home}/pnpm}%{!?with_vendored_pnpm:/usr/bin/pnpm}{:rpmspec}`
SHOULD be used in place of calling `pnpm` itself.

#### %__pnpx
Remotely execute Node modules using PNPX.

Expands to: `/usr/bin/env %{pnpm_common_envvars} /usr/bin/pnpx{:rpmspec}`

#### %vendor_pnpm
This SHOULD only be used if PNPM is not usable/available from the available repositories.

Available flags:
- `-v{:rpmspec}` MAY be used to define a desired version of PNPM.

Usecase examples:
- Fedora's currently packaged PNPM is too old for the build.
- You want to make the package build on EL (does not have PNPM).
  - In this case, you SHOULD wrap `%vendor_pnpm{:rpmspec}` in `%if{:rpmspec}` macros such as:
  - ```rpmspec
     %if %{defined rhel}
     %vendor_pnpm
     %endif
    ```

#### %pnpm_audit
Audit with PNPM if the package uses bundled Node dependencies. For use in the `%check{:rpmspec}` section.

You SHOULD NOT need to fix vulnerabilities for Node modules that are __not bundled in the final package__. This means if a vulnerability is found *only* in build dependencies, you are fine to leave them be.

#### %pnpm_audit_fix
Fix security issues in dependencies using PNPM.

Expands to: `NPM_CONFIG_AUDIT_LEVEL=low %{__pnpm} audit{:rpmspec}`

#### %pnpm_approve_builds
Approve dependency scripts with PNPM if needed.

Available flags:
- `-g{:rpmspec}` can be used to trust depdendencies of globally installed packages.

Expands to: `%{__pnpm} approve-builds{:rpmspec}`

### Yarn Macros
Macros for using [Yarn (Yarn Classic/Yarn v1)](https://classic.yarnpkg.com) and [Yarn Berry (Yarn Modern/Yarn v2+)](https://yarnpkg.com).

You SHOULD use `yarnpkg` (Yarn Classic) unless you need `yarnpkg-berry` (Yarn Berry) specifically.

#### %yarn_common_envvars
Sets the NPM evironment variables and Yarn's cache folder.

Expands to: `%{npm_common_envvars} YARN_CACHE_FOLDER=%{_yarn_cache_dir}{:rpmspec}`

#### %__yarn
Expands to: `/usr/bin/env %{yarn_common_envvars} /usr/bin/yarn{:rpmspec}`

#### %__yarn_dlx
Remotely execute a Node module with Yarn DLX.

Expands to: `/usr/bin/env %{yarn_common_envvars} /usr/bin/yarn dlx{:rpmspec}`

<Callout>
  `yarnpkg-berry` is REQUIRED as a build dependency instead of `yarnpkg`.
</Callout>

#### %yarn_audit
Audit Yarn if the package uses bundled Node dependencies. For use in the `%check{:rpmspec}` section.

You SHOULD NOT need to fix vulnerabilities for Node modules that are __not bundled in the final package__. This means if a vulnerability is found *only* in build dependencies, you are fine to leave them be.

### Other
JavaScript related macros that apply to all or do not fit into any of the above categories.

#### %set_node_build_flags
Set the flags and environment variables used for JavaScript package manager builds.

Based on Fedora's [`%set_build_flags{:rpmspec}` macro](https://src.fedoraproject.org/rpms/redhat-rpm-config/blob/rawhide/f/buildflags.md#using-rpm-build-flags).

Expands to:
```rpmspec
NPM_CONFIG_USERCONFIG="%{rpmbuilddir}/.npmrc" ; export NPM_CONFIG_USERCONFIG ; \
NPM_CONFIG_GLOBALCONFIG="%{rpmbuilddir}/npmrc" ; export NPM_CONFIG_GLOBALCONFIG ; \
NPM_CONFIG_CACHE="%{_npm_cache_dir}" ; export NPM_CONFIG_CACHE ; \
NPM_CONFIG_LOGLEVEL="error" ; export NPM_CONFIG_LOGLEVEL ; \
NPM_CONFIG_FUND="false" ; export NPM_CONFIG_FUND ; \
NPM_CONFIG_UPDATE_NOTIFIER="false" ; export NPM_CONFIG_UPDATE_NOTIFIER ; \
NO_UPDATE_NOTIFIER="1" ; export NO_UPDATE_NOTIFIER ; \
NPM_CONFIG_COLOR="always" ; export NPM_CONFIG_COLOR ; \
NPM_CONFIG_INIT_MODULE="%{rpmbuilddir}/.npm-init.js" ; export NPM_CONFIG_INIT_MODULE ; \
BUN_HOME="%{_bun_home}" ; export BUN_HOME ; \
BUN_INSTALL_CACHE_DIR="%{_bun_cache_dir}" ; export BUN_INSTALL_CACHE_DIR \
BUN_RUNTIME_TRANSPILER_CACHE_PATH="%{_bun_cache_dir}" ; export BUN_RUNTIME_TRANSPILER_CACHE_PATH ; \
PNPM_HOME="%{_pnpm_home}" ; export PNPM_HOME ; \
YARN_CACHE_FOLDER="%{_yarn_cache_dir}" ; export YARN_CACHE_FOLDER ; \
NPMFLAGS="${NPMFLAGS:-%{npm_buildflags} }" ; export NPMFLAGS
```

This ensures the environment variables are explicitly exported and therefor are more likely to be picked up by all shell processes. It also creates an environment variable called `$NPMFLAGS{:bash}` which can be passed to NPM in lieu of the macro `%{npm_buildflags}{:rpmspec}` to force our config, if necessary.

This should only be needed in the event you are using [%__npx](#__npx), [%__pnpx](#__pnpx), [%__bunx](#__bunx), or [%__yarn_dlx](#__yarn_dlx).

## Nim
These macros assist with building Nim projects.
Currently `atlas` is not directly supported by the macros, but you can run it directly in `%build{:rpmspec}`:
```rpmspec
%build
atlas init
atlas rep atlas.lock
%nim_c src/my_project
```

### %nim_prep
Set up build environment with required packages via `nimble setup`.

This also adds the configuration for enabling mold automatically if found in the build environment.

### %nim_build (or %nim_c)
Builds a Nim package.
Requires an argument to `src/pkgname`.

Note that this does not invoke `nimble`. All dependencies SHOULD be ready before `%build{:rpmspec}`.

### %nim_tflags
C compiler flags used in `%nim_c{:rpmspec}`.

### %nim_lflags
Linker flags used in `%nim_c{:rpmspec}`.

## Rust
These macros assist with building Rust projects.

### %cargo_prep_online
Enables internet access for `%cargo_prep{:rpmspec}`. Replaces `%cargo_prep{:rpmspec}` in `%prep{:rpmspec}`.

### %cargo_license_online
Enables internet access for `%cargo_license{:rpmspec}`.
Replaces `%cargo_license{:rpmspec}` in `%build{:rpmspec}`.

### %cargo_license_summary_online
Enables internet access for `%cargo_license_summary{:rpmspec}`.
Replaces `%cargo_license_summary{:rpmspec}` in `%build{:rpmspec}`.

### %cargo_vendor_manifest_online
Enables internet access for `%cargo_vendor_manifest_online{:rpmspec}`.
Replaces `%cargo_vendor_manifest{:rpmspec}` in `%build{:rpmspec}`.

### %crate_install_bin
Used to install crates that build as single binary.
Can be used instead of `%cargo_install{:rpmspec}` when [this](https://github.com/terrapkg/packages/issues/1169) is applicable.

### %rustup_nightly
Used in the `%prep{:rpmspec}` section for nightly `rustc`/`cargo` from `rustup`.

### %cargo_prep_online_sccache
Configures cargo sccache. Generally should not be needed.

## sccache
These macros are for using [sccache](https://github.com/mozilla/sccache).

### %_sccache
Exapnds to: `/usr/bin/sccache`

### %sccache_prep
Sets up environment variables for `sccache`.

## Subpackages
These macros assist with packages that require certain subpackage types.
For example, some packages will build application and library files. Using `%pkg_devel_files{:rpmspec}` will greatly help you in making the library files (`-devel`) subpackage.
More information on subpackages can be found on the [Fedora Packaging Guidelines](https://docs.fedoraproject.org/en-US/packaging-guidelines/#_mixed_use_packages).

### %files_libs
This macro creates library subpackages and installs the library files.
This is only for use in the [`%pkg_devel_files{:rpmspec}` macro](#pkg_devel_files).

### %pkg_completion
This macro creates shell completion subpackages and installs the shell completion files.
This macro SHOULD be used if your package provides shell completion files.
Use the below flags according to the shell completion files your package uses:

```
-B: bash (but the completion file doesn't have `.bash` extension)
-b: bash
-e: elvish
-f: fish
-N: nushell
-z: zsh
```

For specifying the name (the default will be your `%name`) of the shell completion subpackages (if needed):
```
-n pkgname
```

Can also pass `cmd1`, etc. as the commands the completion files are for.

Example using all flags:
```rpmspec
%pkg_completion -BbefNz -n pkgname cmd1 cmd2 ...
```

A good example spec that uses this macro is [yadm](https://github.com/terrapkg/packages/blob/d861164790b3d77f5ee094d303de2dfc3299ef8b/anda/devs/yadm/yadm.spec#L22).
This spec creates these packages:

```
yadm-x.x.x-x.fcxx.noarch.rpm - contains all core package files.
yadm-bash-completion-x.x.x-x.fcxx.noarch.rpm - contains `/usr/share/bash-completion/completions/yadm`
yadm-fish-completion-x.x.x-x.fcxx.noarch.rpm - contains `/usr/share/fish/vendor_completions.d/yadm.fish`
yadm-zsh-completion-x.x.x-x.fcxx.noarch.rpm - contains `/usr/share/zsh/site-functions/_yadm`
```

### %pkg_devel_files
Set the summary & description, then find development files and install them to a subpackages `%files`.
SHOULD be used in place of manually creating `-devel` subpackages.
**NOTE:** You still need to define a `%package devel{:rpmspec}`, and then use this macro below this.
For example:

```rpmspec
%package devel
# generates Summary:, %description devel and the file lists
# -F to omit %files
# -n <pkgname>: name of the devel package
# -N <mainpkg>: name of the main package
%pkg_devel_files
```

### %pkg_static_files
Set the summary & description, then find static libraries.
SHOULD be used in place of manually creating `-static` subpackages.
**NOTE:** You still need to define a `%package static{:rpmspec}`, and then use this macro below this.
For example:

```rpmspec
%package static
# -n <pkgname>: name of the static package
# -N <mainpkg>: name of the main package
%pkg_static_files
```

### %pkg_libs_files
Set the summary & description, then find dynamic library files (will be placed as `%_libdir/*.so.*`).
SHOULD be used in place of manually creating `-libs` subpackages.
**NOTE:** You still need to define a `%package libs{:rpmspec}`, and then use this macro below this.
For example:

```rpmspec
%package libs
# -n <pkgname>: name of the static package
# -N <mainpkg>: name of the main package
%pkg_static_files
```

## Zig
These macros assist with building Zig projects.

### %zig_build_target
Build Zig projects with a specified architecture and build mode.

Available flags:
- `-c` is used to set a specific CPU (micro)architecture to build for. If no argument is supplied, it will fall back to the `%{_target_cpu}` set by the build. You MUST specify a CPU architecture manually in cases where Zig's architecture format and RPM's do not match (e.g., `aarch64`).
  - SHOULD ONLY be used in projects that would not perform correctly when built for baseline.
  - For more information on x86_64 microarchitectures, see [here](https://en.wikipedia.org/wiki/X86-64#Microarchitecture_levels).
- `-r` is used to set the [release/build mode](https://zig.guide/build-system/build-modes). Accepted arguments are `fast`, `small`, `safe`, and `slow`.
  - SHOULD be used if a project would have performance issues if built for `safe` (what Fedora sets by default).
- `-s` is used to allow the project to link statically.
  - SHOULD ONLY be used if a project either has no dependencies to link, OR dependencies from the repos either aren't present or are incompatible versions.
  - You SHOULD still dynamically link compatible dependencies using `-fsys=pkgname`.

Example:
```rpmspec
%build
%{zig_build_target -r fast -c x86_64_v2} \
  -Demit-docs
```

More information can be found on our [Zig packaging guidelines](../terra/policy#zig).

## Miscellaneous
General macros that do not fit into a specific category.

### %evr
Used for declaring how a package interacts with others, such as, in a `Requires:{:rpmspec}` or `Obsoletes:{:rpmspec}` tag.
For example, `Requires: %{name} = %evr{:rpmspec}`.
Expands to: `%{?epoch:%{epoch}:}%{version}-%{release}`.
Real package examples:

`Requires:` example:

```rpmspec
BuildRequires:  pkgconfig(pkgconf)
BuildRequires:  pkgconfig(zlib)
BuildRequires:  pkgconfig(openssl)
BuildRequires:  pkgconfig(libarchive) >= 3.3.3
Requires:       %name-lib = %evr
```

`Recommends:{:rpmspec}` example:

```rpmspec
Name:           rnote
License:        GPL-3.0
Recommends:     rnote-cli = %evr
```

`Provides:{:rpmspec}` example:

```rpmspec
%package devel
Summary:        Development files for %{name}
Requires:       %{name}%{?_isa} = %{version}-%{release}
Provides:		%realname-devel = %evr
Conflicts:		%realname-devel
```

### %git_clone
Downloads the source code via `git clone`, and passes useful (in this situation) flags such as`--depth 1`, `-q`, `--recursive-submodules`, and `-j${RPM_BUILD_NCPUS}`.
A git URL and a `%version{:rpmspec}` or `%commit{:rpmspec}` MAY be passed to this macro.
Below is an example of how a spec that tracks version tages from a GitHub repo, and needs to git clone the source could handle this:

```rpmspec
Version:        0.8.0
---
URL:            https://github.com/ethangreen-dev/lovely-injector
---
%prep
%git_clone %{url} v%{version}
```

Below is an example of how a spec that tracks the latest commit from a GitHub repo, and needs to Git clone the source could handle this:

```rpmspec
%global commit 9417838c91aab6088778089b9a3e8330bca53fbd
---
URL:           https://github.com/ad-oliviero/uwufetch
---
%prep
%git_clone %{url} %{commit}
```

`%git_clone` SHOULD only be used when the source tarballs provided by upstream does not include all required sources in the repository (e.g., if the build process expects a Git environment or the tarball doesn't contain submodules).

### %go_task
Expands to: `go-task --parallel --verbose --yes`
SHOULD be used in place of `go-task` if using Go Task.

## Unused in Spec Files
These macros are ONLY used by other macros in their expansion processes, as programmed [here](https://github.com/terrapkg/srpm-macros).
These are documented ONLY for development and completion sake.

### %__anda_develfiles
Expands to: `%_anda_srpm_macros_dir/find-develinfo.sh %buildroot > anda-develfiles.list{:rpmspec}`
Used as a macro within [`%pkg_devel_files`](#pkg_devel_files).

### %__anda_libsfiles
Expands to: `%_anda_srpm_macros_dir/find-libsinfo.sh %buildroot > anda-libsfiles.list{:rpmspec}`
Used as a macro within [`%pkg_libs_files`](#pkg_libs_files).

### %_anda_srpm_macros_dir
Expands to: `/usr/libexec/anda-srpm-macros`
Anda directory for scripts such as `find-develinfo.sh` used by `%__anda_develfiles{:rpmspec}`, which is used in [`%pkg_devel_files`](#pkg_devel_files).

### %__anda_staticfiles
Expands to: `%_anda_srpm_macros_dir/find-staticinfo.sh %buildroot > anda-staticfiles.list{:rpmspec}`
Creates anda-staticfiles.list file in `%{buildroot}{:rpmspec}` to be used by [`%pkg_static_files`](#pkg_static_files).


### %is_electron_bundled
Expands to `%bcond bundled_electron %["%{name}" != "electron"]{:rpmspec}`
A functional macro that tells other macros if Electron is bundled or if the package being worked with is Electron itself. Used by [`%electronmeta`](#electronmeta) and [`%electron_license`](#electron_license).
