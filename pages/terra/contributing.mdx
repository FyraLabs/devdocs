---
title: Contributing
description: "Get started contributing packages to Terra."
---

import { Callout } from "nextra/components";

# Contributing

Thanks for contributing to Terra!
Terra is specifically designed to be as _package-maintainer-friendly_ as possible â€” you
don't need to know everything about the infrastructure to create a package for Terra!
See the following guide for creating a new package yourself. Quick and easy.

It's also ok to **suggest packages** to include into Terra through raising a [GitHub issue](https://github.com/terrapkg/packages/issues), though it might take a while. (We're busy!)

It takes effort to create a package, and as always, there is a learning curve.
If you ever need help, hop into [our Discord server](https://fyralabs.com/discord) and we will try to help you.

## Creating a package

### Before you begin...

- Make sure the package is not in the [Fedora repositories](https://packages.fedoraproject.org/), and the package name is not taken.
- Review our [packaging policies](#policies) below.
- Review our [packaging guidelines](../terra/guidelines).
- Review our custom [SRPM macros](../terra/SRPM), as these may be helpful to your package.

### Preparation

- Install [Andaman] on your system and its mock configs
  - `[1;32msudo dnf[97m install [0;97;mterra-mock-configs{:ansi}` via Terra
  - anda is also available via rust crates.io
  - If on an atomic system, this command works using podman: `podman run --rm --cap-add=SYS_ADMIN --privileged --volume ./:/anda --volume mock_cache:/var/lib/mock --workdir /anda ghcr.io/terrapkg/builder:frawhide anda`
- Use `rust2rpm` for **Rust** packages
- Use `pyp2rpm` for **Python** packages
- Use `go2rpm` for **Go** packages
- else, find the source of the packages you are adding, preferably a URL to a `.tar.gz` archive
  - multiple archives are ok
  - non `.tar.gz` archives are also ok, but might require additional build dependencies
  - we also prefer archives from git repositories

### Writing sources

1. Fork/clone the [Terra sources repo].
1. Create a folder named after the package name, for example:
   - A font named `lovelyfonttype` would go in `anda/fonts/lovelyfonttype`.
   - A Pantheon DE package would go in `anda/desktops/elementary/`.
1. Inside the folder, create `anda.hcl` and `<packagename>.spec`.
   - Note that font packages in Fedora repos should end with `-fonts`,
     e.g. the folder name is `lovelyfonttype` but the spec file should be `lovelyfonttype-fonts.spec`.
   - The name of the folder name actually is just for identifications for Terra package maintainers.
     What matters is that the spec file name _must_ match with the package name defined in the spec file later.
     This is a Fedora `mock` limitation.
   - For more information, check out our [packaging policies](policy).
1. Edit `anda.hcl`, which tells [Andaman] how to build the package:

   ```hcl
   project pkg {
       rpm {
           spec = "<packagename>.spec"
       }
   }
   ```

1. Edit the spec file.
   - It is a custom file format for RPM packages.
   - This [RPM Packaging Guide] might help newbies with no prior experiences with RPM specs.
   - This [Spec file format] docs goes into the details of the spec file format.

#### Editing the Spec file

> TIP: Check out other spec files for other packages for some examples ;)

A generic spec file looks like this:

```rpmspec
Name:           pkgname
Version:        1.2.3
Release:        1%?dist
Summary:        A package example
URL:            https://example.com
Source0:        https://github.com/some/repo/archive/%{version}.tar.gz
# You should change the above link to the source tarball you got from the preparation section
License:        MIT
BuildRequires:  some dependencies >= 3.2.1 another-dep
Requires:       deps here
# We *highly* encourage you to add yourself as the packager here:
Packager:       Your Name <meowy@example.com>

%description
This is a description of the package that literally does nothing.

%prep
%autosetup -n name-of-folder-after-source0-expansion
# if you are not using a tarball, simply use normal shell commands to extract the sources
echo "hai"

%build
echo "this will run when building pkg"

%install
echo "this will also run when building pkg but for installing it into %{buildroot} so that anda (mock) can package it"

%files
/usr/bin/pkgname-binary
/path/to/more/files/*/package

%changelog
* Wed Jan 11 2006 your-username-here <your_email@idk.xyz>
- Description on what you've done
```

- Add `Source0` or `Source1` or more.
  These preambles should link to a compressed file (preferably `tar`) and will be extracted during `%prep`
  You should've had the link prepared during [#Preparation](#preparation) :3
- Add a new line `%prep`
  - The source file will be automatically downloaded and
    extracted with `%autosetup -n <root dir name in tar file>` inside `%prep`.
    Check out `blackbox-terminal.spec` as an example
  - If it is not a tar archive, extract the file manually with a command.
    See `authy.spec` as an example (`unsquashfs`)
- Inside `%build`, you might need to build the package.
  Macros like `%meson` and `%cmake` are supported.
  Check out `blackbox-terminal` or `prismlauncher`
  - if not, manually state the command
- List out all the files to be included inside `%files`
  - Use `%doc` to state the README file (if it exists)
  - Use `%license` to state the COPYING or LICENSE file (if it exists)
  - TIP: If you are unsure about the files to install, run the build first.
    `mock` will show you the files not packaged but installed via an error
- Add `%changelog` (message preferably "Initial Package")

## Building

- Having anda installed, run the following command:

```ansi
[1;32manda[97m build [0;3;37m-c terra-rawhide-x86_64[0m anda/fonts/lovelyfonttype-fonts/pkg
```

If you would like to use the `rpmbuild` mode instead (which will instead not set
up a container), add `--rpm-builder=rpmbuild`. Remember to install the build
dependencies using `[1;32msudo dnf[97m builddep [0;97;mpath/to/pkgname.spec{:ansi}`!

- You don't need to create `pkg`. It's not supposed to exist, just needs to be at the end of the build command
- Modify the architecture to match your machine (`x86_64`, `aarch64`)
- If the package fails to build, fix your spec file accordingly
  - Usually the actual useful error message can be found before the Python traceback (from mock).
- The built RPM will be inside `anda-build/`

## Done?

- Git commit and push; remember you must sign your commits!
- Create a pull request that merges to the `main` branch

## Automatic updates

The system regarding automatic updates [are described here](autoupdate). Here is an overview:

[Andaman] supports updating via `.rhai` packages.
See the "book" (more like guide) for [Rhai].

- Create `update.rhai` inside the package folder.
- See references from other packages.
- You also need to add `labels { nightly = "1" }{:hcl}` in `anda.hcl` for nightly packages.

<Callout type="info">Remember to add semicolons in Rhai scripts! (`;`)</Callout>
<Callout type="info">
  Anda defaults the filename to `update.rhai`.
  If it's not `update.rhai`, add a new entry inside `anda.hcl`:
  ```hcl
  project pkg {
    rpm {
      update = "path/to/update.rhai"
      ...
    }
  }
  ```
</Callout>

## Policies

Packagers and maintainers MUST follow the policies listed in this document.

## Submission Policy

- Use common sense.
- When it comes to submissions, anything is fair game, assuming that our policies are followed. However, there is a mild exception for GUI applications.
  - Please refrain from submitting applications that work perfectly fine as a Flatpak, unless there is a technical or UX justification for it. Examples of these exceptions are:

    | Application Type | Justification |
    |------------------|---------------|
    | Terminal Emulators | These often only work properly when run directly on the host system. |
    | CLI/TUI applications | The UX of Flatpak isn't optimized for these types of applications. (ex. requiring the user to call Flatpak, and then the RDNN of the app) |
    | Modded/Multi-instance game launchers (i.e Minecraft launchers) | May require access to system libraries, and can be better managed by the user when not sandboxed. For example Minecraft launchers can easily access multiple JRE installations when not sandboxed. |
    | Other appliactions that require manual modification of data files | Requires user to modify its data files regularly, applies in the same above case. |
    | Applications that suffer major performance or technical issues due to sandboxing (IDEs, text editors, file managers, DAWs and other applications that rely on native plugin support like VSTs or LV2, etc.) | These applications usually require systems libraries to be present to work properly. |
    | System components | These packages simply cannot be sandboxed, as they are part of the operating system itself. |
    | Libraries required to build or use the aforementioned packages | These libraries are required to build or use the aforementioned packages, and are usually not sandboxed. |
    
    Other applications that are not specified here may be allowed on a case-by-case basis.
- You MUST have the rights or permission to redistribute the packaged software. Besides that, there is no prohibition on proprietary licenses.
- Submissions must be maintained. We will reject submissions of unmaintained software.
- Submissions MUST NOT be malicious.
- Submissions that may introduce breaking changes must be included in "Terra Extras" instead via the `subrepo = "extras"` label in `anda.hcl`.
  - Example: `terra-mesa` should be in extra as the dependency solver will resolve this package for matching "provides" (such as `mesa-libEGL(x86-64)`).
  - Example: `libadwaita-nightly` should be in extra since it provides `pkgconfig(libadwaita-1)`, which is required by existing packages as a build dependency.
  - Example: `yt-dlp-nightly` **can be included normally** because it has no common provides with Fedora's `yt-dlp`.
  - If you are in doubt whether your submission should be in extra instead, ask and we will decide.
- Submissions SHOULD include an auto-update script (`update.rhai`).
- Submissions SHOULD be placed in the corresponding directory in `anda/`.
  - Each folder MUST either contain folders and no source files (other files are exempted), or contain multiple files and no folders.
  - The following directories have a higher priority. Categorize your new package in the following order:
    1. `fonts/`
    2. `system/` (bootloaders, kernels, drivers, ...)
    3. `tools/buildsys/` (software used to build other software)
    4. `devs/` (tools for software development)
    5. `games/`
    6. `themes/`
    7. `docker/` (software related to containers)
    8. `desktops/` (applications specific to a Desktop Environment)
    9. `apps/` (GUI applications)
    10. `langs/` (software written in/for a specific programming language)
- When there are ambiguous or unspecified parts in our policies/guidelines, you SHOULD refer to [Fedora's packaging guidelines].
- Low-quality contributions will be declined at the team's discretion.
- Do not include work-in-progress code or untested patches. See https://dont-ship.it/.

## Maintenance Policy

- Anyone MAY make a PR (pull request) to an already existing package.
- Unmaintained packages may be removed at any time. Before doing so, we will create a GitHub issue to gauge community interest.
- Terra will only support the latest versions of Fedora, if a package doesn't build on the next version of Fedora, we might hold it back.

## Naming and Versioning Scheme

This section describes the guidelines for naming and versioning packages correctly in both Terra and Terra Extras.

### Tags

First of all, the term "_tag_" is used to refer to different versions of the same software, as in their release schedule/model.
For example, the `zed` package has 3 _tags_: stable, preview and nightly. (Some packages use `tip` instead of `nightly`.)
_Tags_ may be named after git branches from upstream.

Having a different _tag_ of the same software warrants a separate package,
i.e., they MUST have separate spec files with separate `Name:{:rpmspec}`s.
The _tag_ SHOULD be specified in `Name:{:rpmspec}` using the format **`%{rawname}.%{tag}`**
e.g. `ghostty.tip`, `zed.preview`, and `kf6-kio.switcheroo`.

Packages without any _tags_ specified in `Name:{:rpmspec}` MUST be regarded as stable.

For UX reasons, some packages MAY consider specifying `Provides: %{rawname}-%{tag}{:rpmspec}`.

### Versioning

{/* https://github.com/terrapkg/packages/issues/1907 */}
<div style={{ float: "right", margin: "1em" }}>
  | VCS              | ID    |
  |------------------|-------|
  | Git              | `git` |
  | SVN              | `svn` |
  | CVS              | `cvs` |
  | Bazaar           | `bzr` |
  | Mercurial        | `hg`  |
  | Perforce (Helix) | `p4`  |
  | Pijul            | `pjl` |
  | Azure DevOps     | `tfs` |
  | darcs            | `drc` |
  | Fossil           | `fsl` |
</div>

Packages SHOULD follow one of the version formats below:

```rpmspec
## (a)
Version:  %{latest_stable_version}
## (b)
Version:  %{latest_stable_version}^%{commit_date}git.%{shortcommit}
## (c)
Version:  %{unreleased_version}~%{commit_date}git.%{shortcommit}
```

`git` SHOULD be replaced with the correct _VCS identifier_ for **(b)** and **(c)** as listed on the right.

If one of **(b)** and **(c)** is used, you MUST also include `labels { nightly = 1 }{:hcl}` in `anda.hcl` unless there is no `update.rhai`,
as these 2 formats rely on the assumption that there is 1 `%shortcommit` for each `%commit_date` (and vice versa).

`%unreleased_version` refers to the expected version number for the next stable (or a more stable _tag_ than `nightly`) release,
while `%latest_stable_version` refers to the current latest released version number, preferably stable.

**(c)** SHOULD be preferred over **(b)** if possible, since having a `%unreleased_version` can indicate to users
breaking changes/new features depending on the versioning system (usually SemVer).

If upstream does not provide a version, use **(c)** and treat `%unreleased_version` as `0`.

### Release Field

The `Release:{:rpmspec}` preamble MUST NOT contain information regarding upstream versioning,
including but not limited to commit dates, commit SHAs, software versions, _tags_, etc.
Without approval from the team, packages MUST use the format `Release: 1%?dist{:rpmspec}` (or `1%{?dist}{:rpmspec}`).

The release number SHOULD be incremented if changes are made to the package, unless the `Version:{:rpmspec}` changes.

### Naming

Prefix/Suffix the packages in the following order
(that means nightly fonts should end with `-fonts.nightly`)

- Fonts MUST be suffixed with `-fonts`.
- Shared libraries SHOULD be either suffixed with `-libs`.
  - Alternatively, the `lib` prefix is also allowed, but they SHOULD still provide `-libs`.
- Development libraries SHOULD be suffixed with `-devel`.
- If necessary, suffix `-bash-completion` (or other shells) and `-doc`.
- Postfix a _tag_ if necessary (e.g. `.nightly`).

## Miscellaneous Terra Policies

### Security Policy

Our security policy is documented in the [SECURITY.md file].

### Code of Conduct

Our code of conduct is documented in the [CODE_OF_CONDUCT.md file].

### Lifecycle Policy

Our support lifecycle is documented in the [lifecycle page].

[Terra sources repo]: https://github.com/terrapkg/packages
[Rhai]: https://rhai.rs/book/
[Fedora's packaging guidelines]: https://docs.fedoraproject.org/en-US/packaging-guidelines
[SECURITY.md file]: https://github.com/terrapkg/packages/blob/frawhide/SECURITY.md
[CODE_OF_CONDUCT.md file]: https://github.com/terrapkg/packages/blob/frawhide/CODE_OF_CONDUCT.md
[lifecycle page]: ../terra/lifecycle
[andaman]: https://github.com/FyraLabs/anda/
[rpm packaging guide]: https://rpm-packaging-guide.github.io/
[spec file format]: https://rpm-software-management.github.io/rpm/manual/spec.html
