---
title: Introduction
description: Bootstrap a Linux system on Depthcharge with Submarine
---

### Section Under Construction

# Submarine
### Experimental bootloader for ChromeOS' Depthcharge

Submarine provides a minimal Linux environment that lives in a small partition (16mb) on the disk. 
This is used to boot into a full Linux distro using kexec.


## Prebuilt Images
If you're just trying to get Linux running on your Chromebook, these are likely the images you need.

We offer prebuilt versions of the images per each commit:

- [Latest x86_64 build](https://nightly.link/FyraLabs/submarine/workflows/build/main/submarine-x86_64.zip)
- [Latest arm64 build](https://nightly.link/FyraLabs/submarine/workflows/build/main/submarine-arm64.zip)

The kpart file can be flashed to an existing partition, see [Usage](submarine#usage)

## Dependencies

Please make sure you have these dependencies first before building.

```bash
make
gcc
flex
bison
elfutils-devel
parted
vboot-utils
golang
xz
bc
openssl-devel
```

Additionally, you'll need to install u-root. To install the latest version:

```bash
go install github.com/u-root/u-root@latest
```

## Building

Simply clone this repo with submodules, so pass `--recurse-submodules` to `git clone`, then:

```bash
make -j$(nproc) <x86_64|arm64>
```

Please note that you **must** pass an architecture target.

The build output is located in `build/`.
For testing, an image is built at `build/submarine.bin` which you can directly flash onto an external drive.
So, for example, replace `/dev/sdX` with the device file of the external drive:

```bash
sudo dd if=build/submarine.bin of=/dev/sdX
```

## Usage

Before you can boot submarine, you need to enable booting from external storage. On your Chrome device, press Ctrl + Alt + F2 (This will either be the refresh or forward key on the top row) to switch to vt2. Log in as root and run the following commands:

```crossystem dev_boot_usb=1
crossystem dev_boot_signed_only=0
```

For quick testing, you can flash `submarine-<arch>.bin` to an external drive. This image includes a partition table already set up for booting ChromeOS kernels.

Alternatively, you can create your own partition to install submarine to. Start by creating a 16mb partition using your favorite partitioning tool. Next you will edit the partition flags to tell depthcharge that you can boot from that kernel by running `cgpt add -i <partition number> -t kernel -P 15 -T 1 -S 1 /dev/sdX`. As always, substitute in the correct values for your drive. You can then flash `submarine-<arch>.kpart` to the partition you just created.

After installing submarine to an external drive, plug in your drive with submarine to your device while powered off, then power it on. On the developer mode screen, press Ctrl + U to boot from external storage. If all goes well, you should soon see the submarine boot menu.

If you run into any issues, please report them. Include the model of your device, which can be found on the developer mode screen.

## Installing linux to the drive

(This example is based on LMDE6, but it should work for any other distro)
First, ensure that you disk uses a GPT partition table.
Now, create a 16mb partition, this is where submarine will be. Then, you need to add the neccesary flags, `cgpt add -i <partition number> -t kernel -P 15 -T 1 -S 1 /dev/sdX`, dont forget to put the correct values for your disk. Now you can flash `submarine-<arch>.kpart` to this partition!
Now we get to the part where you install your favourite linux distro! 
Submarine needs grub to be able to boot the distro, so create a second partition (anywhere from 64-256mb)
Finally, create a third partition that will house you system. It can be any size but filling the rest of the disk would be most logical.
Now you can begin installing your system to the drive, proceed with the usual installation until you get to the partition screen. This is where you need to mount the third (system) partition as `/`, and the second (grub) partition as `/boot/efi`.
If asked, you should download the grub menu to the second partition, as thats where the grub bootloader will lie.
The rest should be handled by the installer, and once the system finishes, you are ready to use the drive with your chromebook!
Once the submarine menu boot up and shows the list of options, select the number wich correcsponds to your system.

After installing, you should use [Tree's audio script](https://github.com/WeirdTreeThing/chromebook-linux-audio) to get audio working, note that this will create a new kernel, and sho will have a new entry in the boot menu wich you should select.
